<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<link rel="icon" href="assets/favicon.png">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Kinopoisk Watch</title>
	<link rel="stylesheet" href="assets/style.css">
</head>

<body>
	<a id="logo" href="https://github.com/SergaTV/Kinopoisk-Watch" target="_blank">
		<img src="assets/logo.svg">
	</a>

	<div id="container"></div>

	<div id="actions">
		<a id="players">Плееры</a>
		<span>/</span>
		<a id="torrents">Торренты</a>
	</div>

	<span id="info">
		Made with ♥ by <a href="https://github.com/Kirlovon" target="_blank">Kirlovon</a>, copypasted by Stunni
		Powered by <a href="https://yohoho.cc/" target="_blank">this player</a>.
	</span>

	<script>
		const container = document.getElementById('container');
		const actions = document.getElementById('actions');
		const torrents = document.getElementById('torrents');
		const players = document.getElementById('players');

		// Parse params
		const params = new URLSearchParams(window.location.search);
		let id = params.get('id');
		let title = params.get('title');

		// Parse hash for old versions
		const hash = window.location.hash.replace(/\D/g, '');
		if (hash !== '') {
			id = hash;
			console.error('Вы используете старую версию скрипта! Обновитесь до последней версии! \n https://github.com/Kirlovon/Kinopoisk-Watch')
		}

		/**
		 * Switch to players list
		 */
		function selectPlayer() {
			const element = document.createElement('iframe');
			element.src = `${window.location.pathname}watch.html#${id}`;

			players.classList.add('active');
			torrents.classList.remove('active');

			container.innerHTML = '';
			container.appendChild(element);
		}

		/**
		 * Switch to torrents list 
		 */
		function selectTorrent() {
			const element = document.createElement('iframe');
			element.src = `${window.location.pathname}download.html#${encodeURI(title)}`;

			players.classList.remove('active');
			torrents.classList.add('active');

			container.innerHTML = '';
			container.appendChild(element);
		}

		// If ID specified
		if (id) {
			players.addEventListener('click', selectPlayer);
		} else {
			players.classList.add('disabled');
		}

		// If Title specified
		if (title) {
			torrents.addEventListener('click', selectTorrent);
		} else {
			torrents.classList.add('disabled');
		}

		// Show error message if ID & Title are not specified
		if (!id && !title) {
			actions.style.display = 'none';
			container.innerText = 'ID и Название фильма не указаны!'
		}

		// Init
		if (id) {
			selectPlayer();
		} else if (title) {
			selectTorrent();
		}

	</script>
</body>

</html>
